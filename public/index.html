<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Kosmetichka - –†—É–ª–µ—Ç–∫–∞ –∫—Ä–∞—Å–æ—Ç—ã –∏ –ø—Ä–∏–∑–æ–≤</title>
    
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js?58"></script>
    
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/tasks.css">
    <link rel="stylesheet" href="css/tasks-profile.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/profile-animations.css">
    <link rel="stylesheet" href="css/mega-roulette.css">
    <link rel="stylesheet" href="css/mega-roulette-new.css">
    <link rel="stylesheet" href="css/mega-roulette-override.css">
    <link rel="stylesheet" href="css/prizes-table.css">
    <!-- navigation.css –Ω–µ –Ω–∞–π–¥–µ–Ω, —É–¥–∞–ª–µ–Ω -->
    <link rel="stylesheet" href="css/button-states.css">
    
    <!-- Fallback styles -->
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #EF55A5 0%, #809EFF 50%, #CCD537 100%);
            color: white;
            min-height: 100vh;
            width: 100%;
            overflow-x: hidden;
        }
        
        #app {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            overflow-y: auto;
            padding-bottom: 90px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #EF55A5 0%, #809EFF 50%, #CCD537 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2a2a2a;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 95%;
            text-align: center;
            position: relative;
            min-height: 300px;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
        }

        .prize-animation {
            font-size: 80px;
            margin-bottom: 25px;
        }

        .certificate-modal .modal-content {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
        }

        .admin-contact-button {
            background: linear-gradient(45deg, #EF55A5, #FF6B9D);
            border: none;
            color: white;
            padding: 18px 35px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: transform 0.2s;
        }

        .admin-contact-button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner">
            <div class="spinner"></div>
        </div>
        <h2>Kosmetichka Lottery</h2>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <!-- Main App Container -->
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="user-info">
                    <div class="avatar">üë§</div>
                    <div class="user-details">
                        <div class="username" id="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="user-stats">
                            <div class="stars" id="stars-display">
                                <span class="icon">‚≠ê</span>
                                <span class="count" id="stars-count">100</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="settings-button" id="settings-button">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content">
            <!-- Main Screen (Roulette) -->
            <div class="screen active" id="main-screen">
                <div class="wheel-container">
                    <div class="wheel-wrapper">
                        <div class="wheel" id="wheel"></div>
                        <div class="wheel-pointer"></div>
                        <div class="wheel-center">
                            <div class="center-logo">üé∞</div>
                        </div>
                    </div>
                </div>
                
                <div class="spin-controls">
                    <button class="spin-button" id="spin-button">
                        <span>–ö—Ä—É—Ç–∏—Ç—å –∑–∞ ‚≠ê 20</span>
                    </button>
                    <div class="spin-info">
                        <p>–ö—Ä—É—Ç–∏ —Ä—É–ª–µ—Ç–∫—É –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π –ø—Ä–∏–∑—ã!</p>
                    </div>
                </div>

                <div class="recent-wins" id="recent-wins">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–∏</h3>
                    <div class="prize-history" id="prize-history">
                        <!-- Prize history will be populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Tasks Screen -->
            <div class="screen" id="tasks-screen">
                <div class="screen-header">
                    <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
                    <p>–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π –∑–≤–µ–∑–¥—ã!</p>
                </div>
                
                <div class="tasks-container" id="tasks-container">
                    <!-- Tasks will be populated by JS -->
                </div>
            </div>

            <!-- Profile Screen -->
            <div class="screen" id="profile-screen">
                <div class="screen-header">
                    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
                </div>
                
                <div class="profile-container">
                    <div class="profile-stats" id="profile-stats">
                        <!-- Profile stats will be populated by JS -->
                    </div>
                    
                    <div class="leaderboard-section">
                        <h3>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3>
                        <div class="leaderboard" id="leaderboard">
                            <!-- Leaderboard will be populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mega Roulette Screen -->
            <div class="screen" id="mega-roulette-screen">
                <div class="screen-header">
                    <h2>–ú–µ–≥–∞ –†—É–ª–µ—Ç–∫–∞</h2>
                    <p>–ë–æ–ª—å—à–∏–µ –ø—Ä–∏–∑—ã –∂–¥—É—Ç!</p>
                </div>
                
                <div class="mega-roulette-container">
                    <!-- Mega roulette content will be populated by JS -->
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-screen="main-screen">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="nav-item" data-screen="tasks-screen">
                <i class="fas fa-tasks"></i>
                <span>–ó–∞–¥–∞–Ω–∏—è</span>
            </button>
            <button class="nav-item" data-screen="profile-screen">
                <i class="fas fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
        </nav>
    </div>

    <!-- Prize Modal -->
    <div class="modal" id="prize-modal">
        <div class="modal-content">
            <button class="close-button" onclick="closePrizeModal()">&times;</button>
            <div class="prize-animation">
                <i class="fas fa-gift"></i>
            </div>
            <h3 id="prize-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
            <p id="prize-description">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø—Ä–∏–∑!</p>
            <button class="admin-contact-button" onclick="closePrizeModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal certificate-modal" id="certificate-modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeCertificateModal()">&times;</button>
            <div class="prize-animation">
                <i class="fas fa-certificate"></i>
            </div>
            <h3>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
            <p id="certificate-description">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç!</p>
            <div class="certificate-info">
                <p><strong>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞:</strong></p>
                <p>–ù–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–∞—à–µ–≥–æ Telegram ID</p>
                <p class="user-id">ID: <span id="user-telegram-id">123456789</span></p>
            </div>
            <button class="admin-contact-button" onclick="contactAdmin()">
                <i class="fas fa-paper-plane"></i>
                –ù–∞–ø–∏—Å–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
            </button>
            <button class="admin-contact-button" onclick="closeCertificateModal()" style="background: #666; margin-top: 10px;">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>

    <!-- Subscription Check Modal -->
    <div class="modal" id="subscription-modal">
        <div class="modal-content">
            <h3>üì± –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª—ã</h3>
            <p>–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏–≥—Ä—ã –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à–∏ –∫–∞–Ω–∞–ª—ã:</p>
            <div class="subscription-channels" id="subscription-channels">
                <!-- Channels will be populated by JS -->
            </div>
            <button class="admin-contact-button" onclick="checkSubscriptions()">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏
            </button>
        </div>
    </div>

    <!-- JS Configuration and Modules -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/utils/storage.js"></script>
    <script type="module" src="js/utils/api.js"></script>
    <script type="module" src="js/subscription-checker.js"></script>
    <script type="module" src="js/wheel.js"></script>
    <script type="module" src="js/screens/tasks.js"></script>
    <script type="module" src="js/screens/profile.js"></script>
    <script type="module" src="js/navigation.js"></script>
    <script type="module" src="js/app.js"></script>

    <!-- Global Functions -->
    <script>
        // Global functions that need to be accessible from onclick handlers
        function closePrizeModal() {
            document.getElementById('prize-modal').classList.remove('active');
        }

        function closeCertificateModal() {
            document.getElementById('certificate-modal').classList.remove('active');
        }

        function contactAdmin() {
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–º–µ—Å—Ç–æ –±–æ—Ç–∞
            const userTelegramId = document.getElementById('user-telegram-id').textContent;
            const adminMessage = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤—ã–∏–≥—Ä–∞–ª(–∞) —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ Kosmetichka Lottery Bot. –ú–æ–π Telegram ID: ${userTelegramId}`;
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
            const supportUrl = `https://t.me/kosmetichkasupport?text=${encodeURIComponent(adminMessage)}`;
            
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.openTelegramLink(supportUrl);
            } else {
                window.open(supportUrl, '_blank');
            }
            
            closeCertificateModal();
        }

        function checkSubscriptions() {
            // This will be implemented in the JS modules
            if (window.subscriptionChecker) {
                window.subscriptionChecker.checkAllSubscriptions();
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üé∞ Kosmetichka Lottery Bot –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // WebApp –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ telegram-integration.js
            
            // Load security utilities first
            const domSafeScript = document.createElement('script');
            domSafeScript.src = './js/utils/dom-safe.js';
            document.head.appendChild(domSafeScript);
            
            // Load storage utilities
            const storageScript = document.createElement('script');
            storageScript.src = './js/utils/storage.js';
            document.head.appendChild(storageScript);
            
            // Wait for scripts to load
            await Promise.all([
                new Promise(resolve => domSafeScript.onload = resolve),
                new Promise(resolve => storageScript.onload = resolve)
            ]);
            
            // Load telegram integration first (not as module)
            try {
                // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ telegram-integration.js
                const script = document.createElement('script');
                script.src = './js/telegram-integration.js';
                document.head.appendChild(script);
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ telegramIntegration
                await new Promise((resolve, reject) => {
                    script.onload = () => {
                        console.log('‚úÖ Telegram Integration —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
                        
                        // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å timeout
                        let attempts = 0;
                        const maxAttempts = 100; // 5 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
                        
                        const checkInit = () => {
                            attempts++;
                            if (window.telegramIntegration) {
                                console.log('‚úÖ Telegram Integration –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                                resolve();
                            } else if (attempts >= maxAttempts) {
                                console.warn('‚ö†Ô∏è Timeout –æ–∂–∏–¥–∞–Ω–∏—è telegramIntegration, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –Ω–µ–≥–æ');
                                resolve(); // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                            } else {
                                setTimeout(checkInit, 50);
                            }
                        };
                        checkInit();
                    };
                    script.onerror = reject;
                });
                
                // –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                const { default: App } = await import('./js/app.js');
                const app = new App();
                window.app = app; // –î–µ–ª–∞–µ–º app –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º
                await app.init();
                console.log('‚úÖ App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                // Hide loading screen even on error
                const loadingScreen = document.querySelector('.loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
            }
        });
    </script>
</body>
</html>
