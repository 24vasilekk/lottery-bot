# Railway Deployment Guide

## Подготовка к деплою на Railway

### 1. Настройка переменных окружения в Railway

После создания проекта в Railway, добавьте следующие переменные в настройках:

#### Обязательные переменные:
```
BOT_TOKEN=YOUR_BOT_TOKEN_HERE
BOT_USERNAME=your_bot_username
ADMIN_IDS=123456789,987654321
WEBAPP_URL=https://your-project-name.railway.app
NODE_ENV=production
```

#### Опциональные переменные:
```
DEBUG_MODE=false
PORT=3000
```

### 2. Создание нового бота в Telegram

1. Откройте @BotFather в Telegram
2. Отправьте `/newbot`
3. Выберите имя и username для бота
4. Скопируйте токен и добавьте в Railway как `BOT_TOKEN`
5. Установите команды бота: `/setcommands`

### 3. Получение Admin ID

1. Отправьте сообщение боту @userinfobot
2. Скопируйте ваш ID и добавьте в Railway как `ADMIN_IDS`

### 4. Настройка Web App

После деплоя в Railway:
1. Откройте @BotFather
2. Выберите вашего бота
3. Отправьте `/setmenubutton`
4. Укажите URL: `https://your-project-name.railway.app`

### 5. Деплой на Railway

1. Подключите GitHub репозиторий к Railway
2. Railway автоматически обнаружит Node.js проект
3. Установите переменные окружения
4. Деплой произойдет автоматически

### 6. Проверка работы

После деплоя проверьте:
- `https://your-project-name.railway.app/health` - статус сервера
- `https://your-project-name.railway.app/debug` - информация о боте
- Отправьте `/start` боту в Telegram

### 7. Мониторинг

Railway предоставляет логи в реальном времени:
- Откройте проект в Railway
- Перейдите в раздел "Deployments"
- Кликните на активный деплой для просмотра логов

### Структура проекта для Railway

```
lottery-bot/
├── telegram-bot-server.js    # Основной сервер
├── package.json              # Зависимости Node.js
├── public/                   # Статические файлы веб-приложения
├── database.js               # Работа с SQLite
├── .env.example             # Пример переменных окружения
└── RAILWAY_DEPLOYMENT.md    # Это руководство
```

### Важные изменения для Railway

1. **Удалены хардкод токены** - теперь используются только переменные окружения
2. **Улучшена обработка ошибок** - подробные логи для диагностики
3. **Автоматическое определение домена** - используется RAILWAY_PUBLIC_DOMAIN
4. **Безопасный запуск** - проверка наличия всех обязательных переменных

### Устранение проблем

#### Бот не отвечает:
1. Проверьте логи в Railway
2. Убедитесь, что BOT_TOKEN правильный
3. Проверьте, что WEBAPP_URL указывает на ваш Railway домен

#### 409 Conflict Error:
1. Убедитесь, что токен не используется в других местах
2. Проверьте, что только один экземпляр бота запущен

#### Веб-приложение не открывается:
1. Проверьте, что WEBAPP_URL настроен в @BotFather
2. Убедитесь, что статические файлы доступны

### Контакты для поддержки

При возникновении проблем проверьте:
1. Логи Railway
2. Статус сервера `/health`
3. Debug информацию `/debug`