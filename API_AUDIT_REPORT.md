# üîç API ENDPOINTS AUDIT REPORT
*–°—Ä–∞–≤–Ω–µ–Ω–∏–µ API –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –∞–¥–º–∏–Ω–∫–æ–π*

## üìä –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò (Users)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/user/${userId}` - –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
- `/api/user/${userId}/prizes` - –ø—Ä–∏–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ùì
- `/api/user/${userId}/transactions` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚úÖ
- `/api/user/${userId}/tasks` - –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ùì
- `/api/user/${userId}/referrals` - —Ä–µ—Ñ–µ—Ä–∞–ª—ã ‚ùì
- `/api/user/${userId}/profile` (POST) - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è ‚úÖ
- `/api/user/${userId}/balance-sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ ‚ùì

### –ê–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/admin/users` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚úÖ
- `/api/admin/users/${userId}` - –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
- `/api/admin/users/${userId}/balance-history` - –∏—Å—Ç–æ—Ä–∏—è –±–∞–ª–∞–Ω—Å–∞ ‚úÖ
- `/api/admin/users/stars` (POST) - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ –∑–≤–µ–∑–¥–∞–º–∏ ‚úÖ
- `/api/admin/users/${userId}/win-chance` (POST) - —à–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞ ‚úÖ
- `/api/admin/users/status` (POST) - —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
- `/api/admin/users/search` - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚úÖ

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ endpoints –≤ —Å–µ—Ä–≤–µ—Ä–µ** - –Ω–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö API
2. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ endpoints** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ API –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ –∏–º–µ—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã userId vs telegramId** - –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö endpoints

## üéÅ –ü–†–ò–ó–´ (Prizes)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/user/${telegramId}/prizes` - –ø—Ä–∏–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ùì
- `/api/user/claim-prize` (POST) - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–∑–∞ ‚ùì
- `/api/leaderboard/prizes/position/${userId}` - –ø–æ–∑–∏—Ü–∏—è –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ –ø—Ä–∏–∑–æ–≤ ‚ùì

### –ê–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/admin/prizes/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–∑–æ–≤ ‚úÖ
- `/api/admin/prizes` - —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–æ–≤ ‚úÖ
- `/api/admin/prizes/${prizeId}/mark-given` (POST) - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–¥–∞–Ω–Ω—ã–π ‚úÖ
- `/api/admin/prizes/bulk-mark-given` (POST) - –º–∞—Å—Å–æ–≤–∞—è –æ—Ç–º–µ—Ç–∫–∞ ‚úÖ
- `/api/admin/prizes/give-custom` (POST) - –≤—ã–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–∏–∑ ‚úÖ

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `/api/user/${telegramId}/prizes`** –≤ —Å–µ—Ä–≤–µ—Ä–µ
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `/api/user/claim-prize`** –≤ —Å–µ—Ä–≤–µ—Ä–µ  
3. **–†–∞–∑–ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∞–¥–º–∏–Ω–∫–∞ –º–æ–≥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–∑—ã

## üèÜ –õ–ò–î–ï–†–ë–û–†–î (Leaderboard)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/leaderboard-referrals?limit=15` - –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚úÖ
- `/api/leaderboard/referrals/position/${userId}` - –ø–æ–∑–∏—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
- `/api/leaderboard/stars/position/${userId}` - –ø–æ–∑–∏—Ü–∏—è –ø–æ –∑–≤–µ–∑–¥–∞–º ‚ùì
- `/api/leaderboard/spins/position/${userId}` - –ø–æ–∑–∏—Ü–∏—è –ø–æ —Å–ø–∏–Ω–∞–º ‚ùì
- `/api/leaderboard/prizes/position/${userId}` - –ø–æ–∑–∏—Ü–∏—è –ø–æ –ø—Ä–∏–∑–∞–º ‚ùì

### –ê–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –Ω–∞–ø—Ä—è–º—É—é, —Ç–æ–ª—å–∫–æ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚ùì

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–Ω–æ–≥–∏–µ position endpoints** –≤ —Å–µ—Ä–≤–µ—Ä–µ
2. **–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∞–¥–º–∏–Ω–∫—É** - –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ API

## üîÑ –†–ï–§–ï–†–ê–õ–´ (Referrals)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/user/${telegramId}/referrals` - —Ä–µ—Ñ–µ—Ä–∞–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ùì
- `/api/sync-referrals` (POST) - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚úÖ
- `/api/leaderboard-referrals` - –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚úÖ

### –ê–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/admin/referrals/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚úÖ
- `/api/admin/referrals` - —Å–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚úÖ

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ `/api/user/${userId}`** - —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—ã
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `/api/user/${telegramId}/referrals`** –≤ —Å–µ—Ä–≤–µ—Ä–µ

## üìã –ó–ê–î–ê–ù–ò–Ø (Tasks)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `/api/tasks/available/${userId}` - –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è ‚ùì
- `/api/user/${userId}/tasks` - –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ùì
- `/api/update-user-stars` (POST) - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥ ‚ùì

### –ê–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é ‚ùì

## üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ù–ê–ô–î–ï–ù–´:

### 1. **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï ENDPOINTS**
```
–ù–ê–ô–î–ï–ù–û –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –≤ telegram-bot-server.js:
- app.get('/api/admin/users', ...) - —Å—Ç—Ä–æ–∫–∏ 4589, 6812, 8856
- app.post('/api/admin/users/stars', ...) - —Å—Ç—Ä–æ–∫–∏ 4721, 6897, 9048
- app.get('/api/user-referral-rank/:userId', ...) - —Å—Ç—Ä–æ–∫–∏ 910, 1629
```

### 2. **–û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ï ENDPOINTS**
```
–ü–†–ò–õ–û–ñ–ï–ù–ò–ï –ü–´–¢–ê–ï–¢–°–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨, –ù–û –ù–ï–¢ –í –°–ï–†–í–ï–†–ï:
- /api/user/${telegramId}/prizes
- /api/user/claim-prize
- /api/user/${userId}/tasks
- /api/user/${telegramId}/referrals
- /api/tasks/available/${userId}
- /api/leaderboard/stars/position/${userId}
- /api/leaderboard/spins/position/${userId}  
- /api/leaderboard/prizes/position/${userId}
```

### 3. **–ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –ü–ê–†–ê–ú–ï–¢–†–û–í**
```
CONFUSION userId vs telegramId:
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ endpoints –æ–∂–∏–¥–∞—é—Ç userId (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID)
- –î—Ä—É–≥–∏–µ –æ–∂–∏–¥–∞—é—Ç telegramId (Telegram ID)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–æ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç –Ω–µ —Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

## ‚úÖ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

1. **–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è endpoints**
2. **–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ endpoints** 
3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (–≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å telegramId)
4. **–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –ø—Ä–∏–∑–æ–≤ –∏ –∑–∞–¥–∞–Ω–∏–π
5. **–î–æ–±–∞–≤–∏—Ç—å –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –≤ –∞–¥–º–∏–Ω–∫—É**

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢: –í–´–°–û–ö–ò–ô
–≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ 404, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –∞–¥–º–∏–Ω–∫–æ–π.